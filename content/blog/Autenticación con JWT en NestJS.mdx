---
title: 'Autenticaci贸n con JWT en NestJS'
description: 'La forma m谩s segura de proteger tus aplicaciones con JWT'
date: '22 de Julio 2023'
categories: ["NestJS", "JWT", "Backend", "Passport"]
---


# 隆La forma m谩s segura de proteger tus aplicaciones!
隆Hola a todos los amigos desarrolladores! Hoy vamos a hablar de autenticaci贸n con JWT (JSON Web Tokens) en nuestras aplicaciones NestJS. Seguro que muchos de ustedes se preguntan qu茅 es este asunto del JWT y por qu茅 es tan genial para asegurar nuestras apps. Bueno, no se preocupen, que les voy a contar todo en detalle.

## 驴Qu茅 es JWT y para qu茅 se usa?

Primero, vamos a desglosar el nombre. JSON Web Tokens, o simplemente JWT, es un est谩ndar abierto (eso quiere decir que todos pueden usarlo) que nos permite enviar informaci贸n de manera segura entre dos partes. Pero, 驴qu茅 partes son esas? Pueden ser el servidor y el cliente, o incluso diferentes servicios dentro de una misma aplicaci贸n.

JWT se usa principalmente para autenticaci贸n y autorizaci贸n, o sea, para saber qui茅n sos y qu茅 permisos ten茅s en la app. Cuando un usuario inicia sesi贸n, el servidor genera un JWT que contiene informaci贸n sobre el usuario (como su ID o rol), y luego se lo env铆a al cliente. El cliente puede almacenar ese JWT (por ejemplo, en LocalStorage) y enviarlo en cada solicitud al servidor. As铆, el servidor puede verificar si el JWT es v谩lido y conceder acceso a recursos protegidos.

## 驴Por qu茅 es seguro utilizar JWT?

隆Muy buena pregunta! JWT es seguro por varias razones. Primero, est谩 firmado digitalmente, lo que significa que el servidor puede verificar si el JWT ha sido modificado o falsificado. Adem谩s, al no almacenar informaci贸n sensible en el servidor, reducimos la necesidad de almacenar sesiones y, por ende, minimizamos riesgos de robo de informaci贸n.

## JWT vs. Sesiones: 驴Por qu茅 elegir JWT?

A ver, antes de JWT, muchos us谩bamos sesiones para la autenticaci贸n, pero no todo era color de rosas. Con sesiones, el servidor debe mantener un registro de cada sesi贸n activa, lo que puede generar problemas de escalabilidad y rendimiento, 隆un verdadero quilombo! En cambio, JWT es stateless (sin estado), lo que significa que el servidor no necesita guardar informaci贸n del usuario, haciendo las cosas m谩s livianas.

## Implementando JWT en NestJS para proteger rutas

### Paso 1: Instalando las dependencias necesarias 
Primero, necesitamos asegurarnos de tener las dependencias adecuadas instaladas en nuestra aplicaci贸n. Vamos a necesitar `@nestjs/jwt`, `@nestjs/passport` y `passport-jwt`, as铆 que aseg煤rate de tenerlas en tu archivo `package.json`. Si a煤n no las tienes, puedes instalarlas con el siguiente comando:

```bash
npm install @nestjs/jwt @nestjs/passport passport-jwt
``` 

### Paso 2: Configurando el m贸dulo de autenticaci贸n


Ahora, debemos configurar nuestro m贸dulo de autenticaci贸n en el archivo `app.module.ts`. Este m贸dulo ser谩 responsable de manejar todo lo relacionado con la autenticaci贸n JWT en nuestra aplicaci贸n.

```typescript
import { Module } from '@nestjs/common';
import { JwtModule } from '@nestjs/jwt';
import { PassportModule } from '@nestjs/passport';
import { JwtStrategy } from './jwt.strategy';
import { AuthService } from './auth.service';

@Module({
  imports: [
    PassportModule.register({ defaultStrategy: 'jwt' }),
    JwtModule.register({
      secret: 'tu_secreto_super_secreto', // Cambia esto por una clave secreta de verdad
      signOptions: { expiresIn: '1d' },
    }),
  ],
  providers: [AuthService, JwtStrategy],
  exports: [PassportModule, JwtModule],
})
export class AuthModule {}

```

### Paso 3: Creando el archivo `jwt.strategy.ts`

Ahora, vamos a crear el archivo `jwt.strategy.ts` en el mismo directorio que el m贸dulo de autenticaci贸n. Este archivo contendr谩 nuestra estrategia personalizada para manejar la autenticaci贸n JWT.

```typescript
import { Injectable, UnauthorizedException } from '@nestjs/common';
import { PassportStrategy } from '@nestjs/passport';
import { Strategy, ExtractJwt } from 'passport-jwt';
import { JwtPayload } from './jwt-payload.interface';

@Injectable()
export class JwtStrategy extends PassportStrategy(Strategy) {
  constructor() {
    super({
      jwtFromRequest: ExtractJwt.fromAuthHeaderAsBearerToken(),
      secretOrKey: 'tu_secreto_super_secreto', // Debe coincidir con la clave del JwtModule
    });
  }

  async validate(payload: JwtPayload) {
    // Aqu铆 puedes hacer cualquier validaci贸n adicional, 
    //como verificar si el usuario existe en la base de datos
    // Por simplicidad, simplemente retornamos el payload, 
    //pero puedes personalizarlo seg煤n tus necesidades
    return payload;
  }
}
```

### Paso 4: Protegiendo una ruta

Ahora que hemos configurado nuestro m贸dulo de autenticaci贸n y creado nuestra estrategia JWT, es hora de proteger una ruta en nuestro controller.

Primero, supongamos que tenemos un `UserController` con una ruta para obtener los datos del usuario actual:

```typescript
import { Controller, Get, Request, UseGuards } from '@nestjs/common';
import { AuthGuard } from '@nestjs/passport';

@Controller('users')
export class UserController {
  @Get('profile')
  @UseGuards(AuthGuard())
  getProfile(@Request() req) {
    return req.user; 
    // Aqu铆 accedemos a la informaci贸n del usuario autenticado a trav茅s del request
  }
}
```

En el c贸digo anterior, usamos el decorador `@UseGuards(AuthGuard())` para aplicar la protecci贸n JWT a la ruta `profile` en nuestro `UserController`. Esto asegurar谩 que solo los usuarios autenticados (con JWT v谩lido) puedan acceder a esa ruta.

### Paso 5: Protegiendo otros m贸dulos/rutas

Si tienes otros m贸dulos en tu aplicaci贸n y deseas proteger rutas en ellos, simplemente repite el paso 4 para cada ruta que necesites asegurar. Aseg煤rate de importar correctamente el `AuthGuard` en esos m贸dulos.

**Y listo, amigos!**

Con eso, hemos implementado con 茅xito la autenticaci贸n JWT en nuestra aplicaci贸n NestJS. Ahora, nuestras rutas est谩n protegidas y solo los usuarios autenticados pueden acceder a ellas. 隆Asombroso!

Espero que esta gu铆a detallada haya sido de ayuda para ti. Si tienes alguna pregunta o necesitas m谩s aclaraciones, 隆no dudes en preguntar! Ahora, sigue construyendo apps seguras como un verdadero crack. 隆Hasta la pr贸xima! 